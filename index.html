<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中小企業診断士合格ロードマップ - 学習管理ダッシュボード</title>
    <meta name="description" content="中小企業診断士試験合格のための総合学習管理システム。試験日から逆算した学習計画の自動生成、7科目の進捗可視化、過去問演習機能を提供。データはlocalStorageに保存され、完全無料で利用可能。">
    <meta name="keywords" content="中小企業診断士,試験対策,学習計画,進捗管理,過去問,無料,診断士,資格">
    <meta name="author" content="中小企業診断士合格ロードマップ">
    
    <!-- OGP設定 -->
    <meta property="og:title" content="中小企業診断士合格ロードマップ">
    <meta property="og:description" content="試験日から逆算した学習計画の自動生成で確実な合格を目指そう">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://appadaycreator.github.io/shindanshi-roadmap/">
    <meta property="og:image" content="https://appadaycreator.github.io/shindanshi-roadmap/assets/images/ogp.jpg">
    <meta property="og:site_name" content="中小企業診断士合格ロードマップ">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="中小企業診断士合格ロードマップ">
    <meta name="twitter:description" content="試験日から逆算した学習計画の自動生成で確実な合格を目指そう">
    <meta name="twitter:image" content="https://appadaycreator.github.io/shindanshi-roadmap/assets/images/ogp.jpg">
    
    <!-- PWA設定 -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="診断士ロードマップ">
    
    <!-- ファビコン -->
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
    
    <!--外部ライブラリ -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 共通CSS -->
    <link rel="stylesheet" href="css/common.css">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <style>
        /* カスタムCSS */
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        /* 文字サイズ設定 */
        .text-xs-size { font-size: 0.6rem; }
        .text-sm-size { font-size: 0.8rem; }
        .text-base-size { font-size: 1rem; }
        .text-lg-size { font-size: 1.2rem; }
        .text-xl-size { font-size: 1.4rem; }
        
        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        
        /* サイドバー */
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        
        /* カード hover効果 */
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        /* モバイル用ハンバーガーメニュー */
        .hamburger-line {
            transition: all 0.3s ease;
        }
        
        .hamburger-active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .hamburger-active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger-active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        /* 科目色分け */
        .subject-economics { border-left: 4px solid #ef4444; }
        .subject-finance { border-left: 4px solid #f97316; }
        .subject-management { border-left: 4px solid #eab308; }
        .subject-operations { border-left: 4px solid #22c55e; }
        .subject-legal { border-left: 4px solid #06b6d4; }
        .subject-it { border-left: 4px solid #3b82f6; }
        .subject-policy { border-left: 4px solid #8b5cf6; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- ヘッダー（PC用） -->
    <header class="hidden lg:block bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <i class="fas fa-road text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-900" data-i18n="app_title">中小企業診断士合格ロードマップ</h1>
                </div>
                <nav class="flex space-x-8">
                    <a href="index.html" class="nav-link text-blue-600 font-medium" data-i18n="nav_dashboard">ダッシュボード</a>
                    <a href="quiz.html" class="nav-link text-gray-500 hover:text-gray-900" data-i18n="nav_quiz">過去問演習</a>
                    <a href="lp.html" class="nav-link text-gray-500 hover:text-gray-900" data-i18n="nav_about">サービス紹介</a>
                    <a href="usage.html" class="nav-link text-gray-500 hover:text-gray-900" data-i18n="nav_usage">使い方</a>
                    <a href="contact.html" class="nav-link text-gray-500 hover:text-gray-900" data-i18n="nav_contact">お問い合わせ</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <select id="langSelect" class="border border-gray-300 rounded px-2 py-1 text-sm">
                        <option value="ja">日本語</option>
                        <option value="en">English</option>
                    </select>
                    <select id="fontSizeSelect" class="border border-gray-300 rounded px-2 py-1 text-sm">
                        <option value="xs">極小</option>
                        <option value="sm">小</option>
                        <option value="base" selected>標準</option>
                        <option value="lg">大</option>
                        <option value="xl">特大</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- モバイルヘッダー -->
    <header class="lg:hidden bg-white shadow-sm border-b border-gray-200">
        <div class="px-4 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-road text-blue-600 text-xl mr-2"></i>
                    <h1 class="text-lg font-bold text-gray-900" data-i18n="app_title_short">診断士ロードマップ</h1>
                </div>
                <button id="mobileMenuBtn" class="p-2">
                    <div class="w-6 h-6 flex flex-col justify-center space-y-1">
                        <div class="hamburger-line w-full h-0.5 bg-gray-600"></div>
                        <div class="hamburger-line w-full h-0.5 bg-gray-600"></div>
                        <div class="hamburger-line w-full h-0.5 bg-gray-600"></div>
                    </div>
                </button>
            </div>
        </div>
    </header>

    <!-- メインコンテナ -->
    <div class="flex">
        <!-- 左サイドバー（PC用） -->
        <aside class="hidden lg:block w-64 bg-white shadow-sm min-h-screen">
            <div class="p-6">
                <nav class="space-y-4">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3" data-i18n="nav_study">学習管理</h3>
                        <ul class="space-y-2">
                            <li><a href="#dashboard" class="flex items-center px-3 py-2 text-blue-600 bg-blue-50 rounded-md"><i class="fas fa-tachometer-alt mr-3"></i><span data-i18n="nav_dashboard">ダッシュボード</span></a></li>
                            <li><a href="#schedule" class="flex items-center px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-calendar-alt mr-3"></i><span data-i18n="nav_schedule">学習計画</span></a></li>
                            <li><a href="#progress" class="flex items-center px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-chart-line mr-3"></i><span data-i18n="nav_progress">進捗状況</span></a></li>
                            <li><a href="quiz.html" class="flex items-center px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-question-circle mr-3"></i><span data-i18n="nav_quiz">過去問演習</span></a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3" data-i18n="nav_data">データ管理</h3>
                        <ul class="space-y-2">
                            <li><a href="#export" class="flex items-center px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-download mr-3"></i><span data-i18n="nav_export">エクスポート</span></a></li>
                            <li><a href="#import" class="flex items-center px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-upload mr-3"></i><span data-i18n="nav_import">インポート</span></a></li>
                            <li><a href="#backup" class="flex items-center px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-shield-alt mr-3"></i><span data-i18n="nav_backup">バックアップ</span></a></li>
                        </ul>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- 右サイドバー（モバイル用） -->
        <div id="mobileSidebar" class="lg:hidden fixed inset-y-0 right-0 w-80 bg-white shadow-lg z-50 transform translate-x-full sidebar-transition">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold" data-i18n="menu_title">メニュー</h2>
                    <button id="closeSidebarBtn" class="p-2">
                        <i class="fas fa-times text-gray-500"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3" data-i18n="nav_pages">ページ</h3>
                        <ul class="space-y-2">
                            <li><a href="index.html" class="block px-3 py-2 text-blue-600 bg-blue-50 rounded-md"><i class="fas fa-home mr-3"></i><span data-i18n="nav_home">ホーム</span></a></li>
                            <li><a href="lp.html" class="block px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-info-circle mr-3"></i><span data-i18n="nav_about">サービス紹介</span></a></li>
                            <li><a href="usage.html" class="block px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-book mr-3"></i><span data-i18n="nav_usage">使い方</span></a></li>
                            <li><a href="contact.html" class="block px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-md"><i class="fas fa-envelope mr-3"></i><span data-i18n="nav_contact">お問い合わせ</span></a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-3" data-i18n="nav_settings">設定</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="setting_language">言語</label>
                                <select id="mobileLangSelect" class="w-full border border-gray-300 rounded px-3 py-2">
                                    <option value="ja">日本語</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="setting_font_size">文字サイズ</label>
                                <select id="mobileFontSizeSelect" class="w-full border border-gray-300 rounded px-3 py-2">
                                    <option value="xs">極小</option>
                                    <option value="sm">小</option>
                                    <option value="base" selected>標準</option>
                                    <option value="lg">大</option>
                                    <option value="xl">特大</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- モバイルサイドバー背景 -->
        <div id="sidebarOverlay" class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

        <!-- メインコンテンツ -->
        <main class="flex-1 p-6 lg:ml-0">
            <!-- ウェルカムセクション -->
            <div class="mb-8 fade-in">
                <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg shadow-sm p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold mb-2" data-i18n="welcome_title">学習ダッシュボード</h2>
                            <p class="text-blue-100" data-i18n="welcome_message">今日も合格に向けて頑張りましょう！</p>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-blue-200" data-i18n="today_date">今日の日付</div>
                            <div id="currentDate" class="text-xl font-semibold"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 統計カード -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-blue-100 rounded-full">
                            <i class="fas fa-calendar-check text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500" data-i18n="stats_study_days">学習日数</h3>
                            <p id="studyDaysCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-green-100 rounded-full">
                            <i class="fas fa-clock text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500" data-i18n="stats_total_hours">総学習時間</h3>
                            <p id="totalHoursCount" class="text-2xl font-bold text-gray-900">0h</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-yellow-100 rounded-full">
                            <i class="fas fa-chart-line text-yellow-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500" data-i18n="stats_avg_progress">平均進捗率</h3>
                            <p id="avgProgressCount" class="text-2xl font-bold text-gray-900">0%</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-red-100 rounded-full">
                            <i class="fas fa-hourglass-half text-red-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500" data-i18n="stats_remaining_days">残り日数</h3>
                            <p id="remainingDaysCount" class="text-2xl font-bold text-gray-900">--</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover">
                    <div class="flex items-center">
                        <div class="p-3 bg-purple-100 rounded-full">
                            <i class="fas fa-question-circle text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-sm font-medium text-gray-500" data-i18n="stats_quiz_count">解答問題数</h3>
                            <p id="quizCount" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 学習計画作成セクション -->
            <div class="mb-8">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="plan_title">学習計画作成</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="exam_date_label">試験日</label>
                            <input type="date" id="examDate" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="daily_hours_label">1日の学習時間（時間）</label>
                            <input type="number" id="dailyHours" min="0.5" max="12" step="0.5" value="2" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <button id="createPlanBtn" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i><span data-i18n="create_plan_btn">学習計画を作成</span>
                    </button>
                </div>
            </div>

            <!-- 科目別進捗 -->
            <div class="mb-8">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6" data-i18n="subject_progress_title">科目別進捗状況</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="space-y-4" id="subjectProgressList">
                                <!-- 科目進捗が動的に生成される -->
                            </div>
                        </div>
                        
                        <div class="relative" style="height: 300px;">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 今日の学習記録 -->
            <div class="mb-8">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="today_study_title">今日の学習記録</h3>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="study_subject_label">科目</label>
                            <select id="studySubject" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">科目を選択</option>
                                <option value="economics" data-i18n="subject_economics">経済学・経済政策</option>
                                <option value="finance" data-i18n="subject_finance">財務・会計</option>
                                <option value="management" data-i18n="subject_management">企業経営理論</option>
                                <option value="operations" data-i18n="subject_operations">運営管理</option>
                                <option value="legal" data-i18n="subject_legal">経営法務</option>
                                <option value="it" data-i18n="subject_it">経営情報システム</option>
                                <option value="policy" data-i18n="subject_policy">中小企業経営・政策</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="study_hours_label">学習時間（時間）</label>
                            <input type="number" id="studyHours" min="0.1" max="12" step="0.1" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="flex items-end">
                            <button id="addStudyRecordBtn" class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i><span data-i18n="add_record_btn">記録追加</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="study_memo_label">メモ</label>
                        <textarea id="studyMemo" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="今日の学習内容や気づきを記録しましょう"></textarea>
                    </div>
                </div>
            </div>

            <!-- クイックアクション -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover cursor-pointer" onclick="startQuiz()">
                    <div class="text-center">
                        <div class="p-4 bg-red-100 rounded-full inline-block mb-4">
                            <i class="fas fa-question-circle text-red-600 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-i18n="quick_quiz_title">過去問演習</h3>
                        <p class="text-gray-600 text-sm" data-i18n="quick_quiz_desc">ランダムに問題を出題</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover cursor-pointer" onclick="showProgressDetail()">
                    <div class="text-center">
                        <div class="p-4 bg-blue-100 rounded-full inline-block mb-4">
                            <i class="fas fa-chart-line text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-i18n="progress_detail_title">詳細進捗</h3>
                        <p class="text-gray-600 text-sm" data-i18n="progress_detail_desc">科目別の詳細分析</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 card-hover cursor-pointer" onclick="shareProgress()">
                    <div class="text-center">
                        <div class="p-4 bg-green-100 rounded-full inline-block mb-4">
                            <i class="fas fa-share-alt text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2" data-i18n="share_progress_title">進捗をシェア</h3>
                        <p class="text-gray-600 text-sm" data-i18n="share_progress_desc">SNSで学習状況を共有</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 詳細進捗モーダル -->
    <div id="progressDetailModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 overflow-y-auto" onclick="if(event.target === this) closeProgressDetail()">
        <div class="flex items-start justify-center min-h-screen p-4 py-8 sm:py-16">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full relative my-auto">
                <!-- スティッキーヘッダー -->
                <div class="sticky top-0 bg-white border-b border-gray-200 rounded-t-lg z-10">
                    <div class="p-6 pb-4">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-gray-900">詳細進捗分析</h2>
                            <button onclick="closeProgressDetail()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6 pt-4">
                    <!-- 総合統計 -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 rounded-lg p-4">
                            <div class="text-sm font-medium text-blue-600">総学習時間</div>
                            <div id="detailTotalHours" class="text-2xl font-bold text-blue-900">0時間</div>
                        </div>
                        <div class="bg-green-50 rounded-lg p-4">
                            <div class="text-sm font-medium text-green-600">平均進捗率</div>
                            <div id="detailAvgProgress" class="text-2xl font-bold text-green-900">0%</div>
                        </div>
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <div class="text-sm font-medium text-yellow-600">残り日数</div>
                            <div id="detailRemainingDays" class="text-2xl font-bold text-yellow-900">--日</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4">
                            <div class="text-sm font-medium text-purple-600">必要学習時間/日</div>
                            <div id="detailRequiredHours" class="text-2xl font-bold text-purple-900">--時間</div>
                        </div>
                    </div>
                    
                    <!-- タブ切り替え -->
                    <div class="sticky top-16 sm:top-20 bg-white z-10 -mx-6 px-6 pt-4 pb-4">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8">
                            <button onclick="switchDetailTab('subject')" class="detail-tab-btn border-b-2 border-blue-500 py-2 px-1 text-sm font-medium text-blue-600" data-tab="subject">
                                科目別分析
                            </button>
                            <button onclick="switchDetailTab('timeline')" class="detail-tab-btn border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="timeline">
                                学習履歴
                            </button>
                            <button onclick="switchDetailTab('weekly')" class="detail-tab-btn border-b-2 border-transparent py-2 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="weekly">
                                週次推移
                            </button>
                            </nav>
                        </div>
                    </div>
                    
                    <!-- 科目別分析 -->
                    <div id="subjectDetailTab" class="detail-tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-lg font-semibold mb-4">科目別進捗詳細</h3>
                                <div id="subjectDetailList" class="space-y-3">
                                    <!-- 動的に生成 -->
                                </div>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold mb-4">進捗グラフ</h3>
                                <div class="relative" style="height: 250px; max-height: 250px;">
                                    <canvas id="detailProgressChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 学習履歴 -->
                    <div id="timelineDetailTab" class="detail-tab-content hidden">
                        <h3 class="text-lg font-semibold mb-4">最近の学習履歴</h3>
                        <div id="studyTimelineList" class="space-y-2">
                            <!-- 動的に生成 -->
                        </div>
                    </div>
                    
                    <!-- 週次推移 -->
                    <div id="weeklyDetailTab" class="detail-tab-content hidden">
                        <h3 class="text-lg font-semibold mb-4">週次学習時間推移</h3>
                        <div class="relative" style="height: 250px; max-height: 250px;">
                            <canvas id="weeklyProgressChart"></canvas>
                        </div>
                        <div class="mt-4">
                            <h4 class="font-semibold mb-2">週別サマリー</h4>
                            <div id="weeklySummaryList" class="space-y-2">
                                <!-- 動的に生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知・モーダル -->
    <div id="notification" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg border p-4 max-w-sm">
            <div class="flex items-center">
                <div id="notificationIcon" class="mr-3"></div>
                <div>
                    <div id="notificationTitle" class="font-semibold"></div>
                    <div id="notificationMessage" class="text-sm text-gray-600"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // グローバル変数
        let currentLang = 'ja';
        let currentFontSize = 'base';
        let studyData = {};
        let progressChart;
        
        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 中小企業診断士合格ロードマップ - 初期化開始');
            
            initializeApp();
            loadUserData();
            setupEventListeners();
            updateCurrentDate();
            renderSubjectProgress();
            createProgressChart();
            
            console.log('✅ アプリケーション初期化完了');
        });
        
        // アプリケーション初期化
        function initializeApp() {
            console.log('📱 アプリケーション初期化中...');
            
            // ローカルストレージから設定を読み込み
            const savedLang = localStorage.getItem('app_language') || 'ja';
            const savedFontSize = localStorage.getItem('app_font_size') || 'base';
            
            setLanguage(savedLang);
            setFontSize(savedFontSize);
            
            // 初期データ設定
            if (!localStorage.getItem('study_data')) {
                studyData = {
                    examDate: null,
                    dailyHours: 2,
                    subjects: {
                        economics: { progress: 0, hours: 0, lastStudied: null },
                        finance: { progress: 0, hours: 0, lastStudied: null },
                        management: { progress: 0, hours: 0, lastStudied: null },
                        operations: { progress: 0, hours: 0, lastStudied: null },
                        legal: { progress: 0, hours: 0, lastStudied: null },
                        it: { progress: 0, hours: 0, lastStudied: null },
                        policy: { progress: 0, hours: 0, lastStudied: null }
                    },
                    studyRecords: [],
                    quizResults: []
                };
                saveUserData();
            }
        }
        
        // イベントリスナー設定
        function setupEventListeners() {
            console.log('🔗 イベントリスナー設定中...');
            
            // モバイルメニュー
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileSidebar = document.getElementById('mobileSidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const closeSidebarBtn = document.getElementById('closeSidebarBtn');
            
            mobileMenuBtn.addEventListener('click', openMobileSidebar);
            closeSidebarBtn.addEventListener('click', closeMobileSidebar);
            sidebarOverlay.addEventListener('click', closeMobileSidebar);
            
            // 言語・フォントサイズ変更
            document.getElementById('langSelect').addEventListener('change', (e) => setLanguage(e.target.value));
            document.getElementById('mobileLangSelect').addEventListener('change', (e) => setLanguage(e.target.value));
            document.getElementById('fontSizeSelect').addEventListener('change', (e) => setFontSize(e.target.value));
            document.getElementById('mobileFontSizeSelect').addEventListener('change', (e) => setFontSize(e.target.value));
            
            // 学習計画作成
            document.getElementById('createPlanBtn').addEventListener('click', createStudyPlan);
            
            // 学習記録追加
            document.getElementById('addStudyRecordBtn').addEventListener('click', addStudyRecord);
            
            // ESCキーでモーダルを閉じる
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('progressDetailModal');
                    if (!modal.classList.contains('hidden')) {
                        closeProgressDetail();
                    }
                }
            });
            
            console.log('✅ イベントリスナー設定完了');
        }
        
        // モバイルサイドバー操作
        function openMobileSidebar() {
            console.log('📱 モバイルサイドバーを開く');
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const menuBtn = document.getElementById('mobileMenuBtn');
            
            sidebar.classList.remove('translate-x-full');
            overlay.classList.remove('hidden');
            menuBtn.classList.add('hamburger-active');
        }
        
        function closeMobileSidebar() {
            console.log('📱 モバイルサイドバーを閉じる');
            const sidebar = document.getElementById('mobileSidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const menuBtn = document.getElementById('mobileMenuBtn');
            
            sidebar.classList.add('translate-x-full');
            overlay.classList.add('hidden');
            menuBtn.classList.remove('hamburger-active');
        }
        
        // 言語設定
        function setLanguage(lang) {
            console.log('🌐 言語を変更:', lang);
            currentLang = lang;
            localStorage.setItem('app_language', lang);
            
            // セレクトボックスの値を同期
            document.getElementById('langSelect').value = lang;
            document.getElementById('mobileLangSelect').value = lang;
            
            // 多言語対応の実装（簡易版）
            updateTexts();
        }
        
        // フォントサイズ設定
        function setFontSize(size) {
            console.log('🔤 フォントサイズを変更:', size);
            currentFontSize = size;
            localStorage.setItem('app_font_size', size);
            
            // セレクトボックスの値を同期
            document.getElementById('fontSizeSelect').value = size;
            document.getElementById('mobileFontSizeSelect').value = size;
            
            // bodyにクラスを適用
            document.body.className = document.body.className.replace(/text-\w+-size/g, '');
            document.body.classList.add(`text-${size}-size`);
        }
        
        // 現在日付の表示
        function updateCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            document.getElementById('currentDate').textContent = dateStr;
        }
        
        // ユーザーデータの読み込み
        function loadUserData() {
            console.log('💾 ユーザーデータを読み込み中...');
            const savedData = localStorage.getItem('study_data');
            if (savedData) {
                studyData = JSON.parse(savedData);
                console.log('✅ ユーザーデータ読み込み完了:', studyData);
                updateStatistics();
            }
        }
        
        // ユーザーデータの保存
        function saveUserData() {
            console.log('💾 ユーザーデータを保存中...');
            localStorage.setItem('study_data', JSON.stringify(studyData));
            console.log('✅ ユーザーデータ保存完了');
        }
        
        // 保存されたデータを取得（詳細進捗機能用）
        function getStoredData() {
            return studyData;
        }
        
        // 総学習時間を計算
        function calculateTotalHours(data) {
            const records = data.studyRecords || [];
            return records.reduce((sum, record) => sum + record.hours, 0).toFixed(1);
        }
        
        // 平均進捗率を計算
        function calculateAverageProgress(data) {
            const subjects = Object.values(data.subjects || {});
            if (subjects.length === 0) return 0;
            const totalProgress = subjects.reduce((sum, subject) => sum + subject.progress, 0);
            return Math.round(totalProgress / subjects.length);
        }
        
        // 残り日数を計算
        function calculateRemainingDays(examDate) {
            if (!examDate) return null;
            const today = new Date();
            const exam = new Date(examDate);
            const diffTime = exam - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 0 ? diffDays : 0;
        }
        
        // 科目名を取得
        function getSubjectName(key) {
            const names = {
                economics: '経済学・経済政策',
                finance: '財務・会計',
                management: '企業経営理論',
                operations: '運営管理',
                legal: '経営法務',
                it: '経営情報システム',
                policy: '中小企業経営・政策'
            };
            return names[key] || key;
        }
        
        // 科目の色を取得
        function getSubjectColor(key) {
            const colors = {
                economics: 'red',
                finance: 'orange',
                management: 'yellow',
                operations: 'green',
                legal: 'cyan',
                it: 'blue',
                policy: 'purple'
            };
            return colors[key] || 'gray';
        }
        
        // 日付フォーマット
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }
        
        // 統計情報の更新
        function updateStatistics() {
            console.log('📊 統計情報を更新中...');
            
            // 学習日数
            const uniqueDates = [...new Set(studyData.studyRecords.map(record => record.date))];
            document.getElementById('studyDaysCount').textContent = uniqueDates.length;
            
            // 総学習時間
            const totalHours = studyData.studyRecords.reduce((sum, record) => sum + record.hours, 0);
            document.getElementById('totalHoursCount').textContent = `${totalHours.toFixed(1)}h`;
            
            // 平均進捗率
            const subjects = Object.values(studyData.subjects);
            const avgProgress = subjects.reduce((sum, subject) => sum + subject.progress, 0) / subjects.length;
            document.getElementById('avgProgressCount').textContent = `${Math.round(avgProgress)}%`;
            
            // 解答問題数
            const quizCount = studyData.quizResults.length;
            document.getElementById('quizCount').textContent = quizCount;
            
            // 残り日数
            const remainingDays = calculateRemainingDays(studyData.examDate);
            if (remainingDays !== null) {
                document.getElementById('remainingDaysCount').textContent = `${remainingDays}日`;
                // 残り日数によって色を変更
                const element = document.getElementById('remainingDaysCount');
                if (remainingDays <= 30) {
                    element.classList.add('text-red-600');
                    element.classList.remove('text-gray-900');
                } else if (remainingDays <= 60) {
                    element.classList.add('text-yellow-600');
                    element.classList.remove('text-gray-900');
                } else {
                    element.classList.remove('text-red-600', 'text-yellow-600');
                    element.classList.add('text-gray-900');
                }
            } else {
                document.getElementById('remainingDaysCount').textContent = '--';
            }
            
            console.log('✅ 統計情報更新完了');
        }
        
        // 科目別進捗の表示
        function renderSubjectProgress() {
            console.log('📈 科目別進捗を表示中...');
            const container = document.getElementById('subjectProgressList');
            
            const subjects = [
                { key: 'economics', name: '経済学・経済政策', color: 'red' },
                { key: 'finance', name: '財務・会計', color: 'orange' },
                { key: 'management', name: '企業経営理論', color: 'yellow' },
                { key: 'operations', name: '運営管理', color: 'green' },
                { key: 'legal', name: '経営法務', color: 'cyan' },
                { key: 'it', name: '経営情報システム', color: 'blue' },
                { key: 'policy', name: '中小企業経営・政策', color: 'purple' }
            ];
            
            container.innerHTML = subjects.map(subject => {
                const progress = studyData.subjects[subject.key]?.progress || 0;
                return `
                    <div class="subject-${subject.key} bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-medium text-gray-900">${subject.name}</h4>
                            <span class="text-sm font-semibold text-gray-600">${progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-${subject.color}-500 h-2 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            console.log('✅ 科目別進捗表示完了');
        }
        
        // 進捗チャートの作成
        function createProgressChart() {
            console.log('📊 進捗チャートを作成中...');
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            const subjects = ['経済学', '財務', '企業経営', '運営管理', '経営法務', '情報システム', '中小企業'];
            const progressData = Object.values(studyData.subjects).map(subject => subject.progress);
            
            progressChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: subjects,
                    datasets: [{
                        label: '進捗率 (%)',
                        data: progressData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            console.log('✅ 進捗チャート作成完了');
        }
        
        // 学習計画作成
        function createStudyPlan() {
            console.log('📅 学習計画を作成中...');
            const examDate = document.getElementById('examDate').value;
            const dailyHours = parseFloat(document.getElementById('dailyHours').value);
            
            if (!examDate) {
                showNotification('エラー', '試験日を入力してください', 'error');
                return;
            }
            
            const today = new Date();
            const exam = new Date(examDate);
            const diffTime = exam - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 0) {
                showNotification('エラー', '試験日は今日より後の日付を選択してください', 'error');
                return;
            }
            
            studyData.examDate = examDate;
            studyData.dailyHours = dailyHours;
            
            const totalHours = diffDays * dailyHours;
            const hoursPerSubject = totalHours / 7;
            
            console.log(`📊 学習計画: ${diffDays}日間、1日${dailyHours}時間、科目あたり${hoursPerSubject.toFixed(1)}時間`);
            
            saveUserData();
            updateStatistics(); // 統計情報を更新
            showNotification('成功', `${diffDays}日間の学習計画を作成しました！`, 'success');
        }
        
        // 学習記録追加
        function addStudyRecord() {
            console.log('📝 学習記録を追加中...');
            const subject = document.getElementById('studySubject').value;
            const hours = parseFloat(document.getElementById('studyHours').value);
            const memo = document.getElementById('studyMemo').value;
            
            if (!subject || !hours) {
                showNotification('エラー', '科目と学習時間を入力してください', 'error');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const record = {
                date: today,
                subject: subject,
                hours: hours,
                memo: memo,
                timestamp: new Date().toISOString()
            };
            
            studyData.studyRecords.push(record);
            studyData.subjects[subject].hours += hours;
            studyData.subjects[subject].lastStudied = today;
            
            // 進捗率の更新（簡易計算）
            if (studyData.examDate) {
                const totalTargetHours = studyData.dailyHours * 
                    Math.ceil((new Date(studyData.examDate) - new Date()) / (1000 * 60 * 60 * 24)) / 7;
                studyData.subjects[subject].progress = Math.min(100, 
                    (studyData.subjects[subject].hours / totalTargetHours) * 100);
            }
            
            saveUserData();
            updateStatistics();
            renderSubjectProgress();
            
            if (progressChart) {
                progressChart.data.datasets[0].data = Object.values(studyData.subjects).map(s => s.progress);
                progressChart.update();
            }
            
            // フォームリセット
            document.getElementById('studySubject').value = '';
            document.getElementById('studyHours').value = '';
            document.getElementById('studyMemo').value = '';
            
            showNotification('成功', '学習記録を追加しました！', 'success');
            console.log('✅ 学習記録追加完了:', record);
        }
        
        // クイックアクション機能
        function startQuiz() {
            console.log('🎯 過去問演習を開始');
            showNotification('情報', '過去問機能は開発中です', 'info');
        }
        
        // 詳細進捗モーダルの表示
        function showProgressDetail() {
            console.log('📊 詳細進捗を表示');
            const modal = document.getElementById('progressDetailModal');
            modal.classList.remove('hidden');
            
            // bodyのスクロールを無効化
            document.body.style.overflow = 'hidden';
            
            // データの取得と表示
            updateDetailedProgressData();
            
            // デフォルトで科目別分析タブを表示
            switchDetailTab('subject');
            
            // モーダルのスクロール位置をトップに
            modal.scrollTop = 0;
        }
        
        // 詳細進捗モーダルを閉じる
        function closeProgressDetail() {
            const modal = document.getElementById('progressDetailModal');
            modal.classList.add('hidden');
            
            // bodyのスクロールを再有効化
            document.body.style.overflow = '';
        }
        
        // 詳細進捗データの更新
        function updateDetailedProgressData() {
            const studyData = getStoredData();
            
            // 総合統計の更新
            const totalHours = calculateTotalHours(studyData);
            const avgProgress = calculateAverageProgress(studyData);
            const remainingDays = calculateRemainingDays(studyData.examDate);
            const requiredHours = calculateRequiredHoursPerDay(studyData);
            
            document.getElementById('detailTotalHours').textContent = `${totalHours}時間`;
            document.getElementById('detailAvgProgress').textContent = `${avgProgress}%`;
            document.getElementById('detailRemainingDays').textContent = remainingDays !== null ? `${remainingDays}日` : '--日';
            document.getElementById('detailRequiredHours').textContent = requiredHours !== null ? `${requiredHours.toFixed(1)}時間` : '--時間';
            
            // 科目別詳細リストの生成
            updateSubjectDetailList(studyData);
            
            // 詳細進捗グラフの描画
            drawDetailProgressChart(studyData);
            
            // 学習履歴の生成
            updateStudyTimeline(studyData);
            
            // 週次推移グラフの描画
            drawWeeklyProgressChart(studyData);
        }
        
        // 科目別詳細リストの更新
        function updateSubjectDetailList(studyData) {
            const container = document.getElementById('subjectDetailList');
            container.innerHTML = '';
            
            const subjects = studyData.subjects || {};
            const subjectOrder = ['economics', 'finance', 'management', 'operations', 'legal', 'it', 'policy'];
            
            subjectOrder.forEach(key => {
                const subject = subjects[key] || { progress: 0, hours: 0, lastStudied: null };
                const targetHours = getTargetHours(key);
                const completionRate = targetHours > 0 ? Math.round((subject.hours / targetHours) * 100) : 0;
                
                const subjectItem = document.createElement('div');
                subjectItem.className = 'bg-gray-50 rounded-lg p-4';
                subjectItem.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-semibold text-gray-900">${getSubjectName(key)}</h4>
                        <span class="text-sm text-gray-600">${subject.progress}%</span>
                    </div>
                    <div class="mb-2">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div class="bg-${getSubjectColor(key)}-500 h-2 rounded-full transition-all duration-300" style="width: ${subject.progress}%"></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-gray-500">学習時間:</span>
                            <span class="font-medium">${subject.hours.toFixed(1)}時間</span>
                        </div>
                        <div>
                            <span class="text-gray-500">目標達成率:</span>
                            <span class="font-medium">${completionRate}%</span>
                        </div>
                        <div>
                            <span class="text-gray-500">最終学習:</span>
                            <span class="font-medium">${subject.lastStudied ? formatDate(subject.lastStudied) : '未学習'}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">残り時間:</span>
                            <span class="font-medium">${Math.max(0, targetHours - subject.hours).toFixed(1)}時間</span>
                        </div>
                    </div>
                `;
                container.appendChild(subjectItem);
            });
        }
        
        // 詳細進捗グラフの描画
        function drawDetailProgressChart(studyData) {
            const canvas = document.getElementById('detailProgressChart');
            const ctx = canvas.getContext('2d');
            
            // 既存のチャートがあれば破棄
            if (window.detailProgressChartInstance) {
                window.detailProgressChartInstance.destroy();
            }
            
            const subjects = studyData.subjects || {};
            const labels = ['経済学', '財務会計', '企業経営', '運営管理', '経営法務', '情報システム', '中小企業政策'];
            const progressData = [
                subjects.economics?.progress || 0,
                subjects.finance?.progress || 0,
                subjects.management?.progress || 0,
                subjects.operations?.progress || 0,
                subjects.legal?.progress || 0,
                subjects.it?.progress || 0,
                subjects.policy?.progress || 0
            ];
            const hoursData = [
                subjects.economics?.hours || 0,
                subjects.finance?.hours || 0,
                subjects.management?.hours || 0,
                subjects.operations?.hours || 0,
                subjects.legal?.hours || 0,
                subjects.it?.hours || 0,
                subjects.policy?.hours || 0
            ];
            
            window.detailProgressChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '進捗率 (%)',
                        data: progressData,
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: '学習時間 (h)',
                        data: hoursData,
                        type: 'line',
                        borderColor: 'rgba(34, 197, 94, 1)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '進捗率 (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '学習時間 (h)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            }
                        }
                    }
                }
            });
        }
        
        // 学習履歴の更新
        function updateStudyTimeline(studyData) {
            const container = document.getElementById('studyTimelineList');
            container.innerHTML = '';
            
            const records = studyData.studyRecords || [];
            const sortedRecords = [...records].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const recentRecords = sortedRecords.slice(0, 20);
            
            if (recentRecords.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">まだ学習記録がありません</p>';
                return;
            }
            
            recentRecords.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors';
                recordItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-2 h-2 bg-${getSubjectColor(record.subject)}-500 rounded-full"></div>
                        <div>
                            <div class="font-medium text-gray-900">${getSubjectName(record.subject)}</div>
                            <div class="text-sm text-gray-500">${formatDateTime(record.timestamp)}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-medium text-gray-900">${record.hours}時間</div>
                        ${record.memo ? `<div class="text-sm text-gray-500 max-w-xs truncate">${record.memo}</div>` : ''}
                    </div>
                `;
                container.appendChild(recordItem);
            });
        }
        
        // 週次推移グラフの描画
        function drawWeeklyProgressChart(studyData) {
            const canvas = document.getElementById('weeklyProgressChart');
            const ctx = canvas.getContext('2d');
            
            // 既存のチャートがあれば破棄
            if (window.weeklyProgressChartInstance) {
                window.weeklyProgressChartInstance.destroy();
            }
            
            const weeklyData = calculateWeeklyProgress(studyData);
            
            window.weeklyProgressChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeklyData.labels,
                    datasets: [{
                        label: '週間学習時間',
                        data: weeklyData.hours,
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '学習時間 (h)'
                            }
                        }
                    }
                }
            });
            
            // 週別サマリーの更新
            updateWeeklySummary(weeklyData);
        }
        
        // 週別学習時間の計算
        function calculateWeeklyProgress(studyData) {
            const records = studyData.studyRecords || [];
            const weeklyMap = new Map();
            
            records.forEach(record => {
                const date = new Date(record.timestamp);
                const weekStart = getWeekStart(date);
                const weekKey = formatDate(weekStart);
                
                if (!weeklyMap.has(weekKey)) {
                    weeklyMap.set(weekKey, { hours: 0, count: 0 });
                }
                
                const week = weeklyMap.get(weekKey);
                week.hours += record.hours;
                week.count += 1;
            });
            
            // 直近8週間のデータを生成
            const labels = [];
            const hours = [];
            const summaryData = [];
            
            for (let i = 7; i >= 0; i--) {
                const weekStart = new Date();
                weekStart.setDate(weekStart.getDate() - (i * 7) - weekStart.getDay());
                weekStart.setHours(0, 0, 0, 0);
                
                const weekKey = formatDate(weekStart);
                const weekData = weeklyMap.get(weekKey) || { hours: 0, count: 0 };
                
                labels.push(`第${8-i}週`);
                hours.push(weekData.hours);
                summaryData.push({
                    week: `第${8-i}週`,
                    startDate: weekStart,
                    hours: weekData.hours,
                    count: weekData.count
                });
            }
            
            return { labels, hours, summaryData };
        }
        
        // 週の開始日を取得
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }
        
        // 週別サマリーの更新
        function updateWeeklySummary(weeklyData) {
            const container = document.getElementById('weeklySummaryList');
            container.innerHTML = '';
            
            weeklyData.summaryData.forEach(week => {
                if (week.hours > 0) {
                    const avgHours = week.count > 0 ? (week.hours / 7).toFixed(1) : 0;
                    const summaryItem = document.createElement('div');
                    summaryItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                    summaryItem.innerHTML = `
                        <div>
                            <div class="font-medium text-gray-900">${week.week} (${formatDate(week.startDate)}〜)</div>
                            <div class="text-sm text-gray-500">学習日数: ${week.count}日</div>
                        </div>
                        <div class="text-right">
                            <div class="font-medium text-gray-900">${week.hours.toFixed(1)}時間</div>
                            <div class="text-sm text-gray-500">平均: ${avgHours}時間/日</div>
                        </div>
                    `;
                    container.appendChild(summaryItem);
                }
            });
            
            if (container.innerHTML === '') {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">まだ週次データがありません</p>';
            }
        }
        
        // タブ切り替え
        function switchDetailTab(tabName) {
            // すべてのタブボタンとコンテンツを非アクティブに
            document.querySelectorAll('.detail-tab-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.querySelectorAll('.detail-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // 選択されたタブをアクティブに
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.remove('border-transparent', 'text-gray-500');
            activeBtn.classList.add('border-blue-500', 'text-blue-600');
            
            document.getElementById(`${tabName}DetailTab`).classList.remove('hidden');
        }
        
        // 必要な学習時間/日の計算
        function calculateRequiredHoursPerDay(studyData) {
            if (!studyData.examDate) return null;
            
            const remainingDays = calculateRemainingDays(studyData.examDate);
            if (remainingDays <= 0) return null;
            
            const totalTargetHours = 1000; // 仮の目標総学習時間
            const completedHours = calculateTotalHours(studyData);
            const remainingHours = Math.max(0, totalTargetHours - completedHours);
            
            return remainingHours / remainingDays;
        }
        
        // 科目ごとの目標時間を取得
        function getTargetHours(subject) {
            const targetHours = {
                economics: 150,
                finance: 200,
                management: 150,
                operations: 120,
                legal: 120,
                it: 120,
                policy: 140
            };
            return targetHours[subject] || 0;
        }
        
        // 日付時刻のフォーマット
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}/${month}/${day} ${hours}:${minutes}`;
        }
        
        // シェア実行中フラグ
        let isSharing = false;
        
        function shareProgress() {
            console.log('📤 進捗をシェア');
            
            // 既にシェア実行中の場合は処理しない
            if (isSharing) {
                console.log('⚠️ 既にシェア実行中です');
                return;
            }
            
            if (navigator.share) {
                isSharing = true;
                
                // 現在の進捗データを取得
                const studyData = getStoredData();
                const averageProgress = calculateAverageProgress(studyData);
                const totalHours = calculateTotalHours(studyData);
                
                const shareData = {
                    title: '中小企業診断士合格ロードマップ',
                    text: `学習進捗: ${averageProgress}% (総学習時間: ${totalHours}時間)\n効率的な学習で合格を目指しています！`,
                    url: window.location.href
                };
                
                navigator.share(shareData)
                    .then(() => {
                        console.log('✅ シェア完了');
                        showNotification('成功', '進捗を共有しました！', 'success');
                    })
                    .catch((error) => {
                        console.log('ℹ️ シェア処理:', error.name);
                        if (error.name === 'AbortError') {
                            // ユーザーがキャンセルした場合は何もしない（正常な動作）
                            console.log('👆 ユーザーがシェアをキャンセルしました');
                        } else if (error.name === 'NotAllowedError') {
                            showNotification('エラー', 'シェア機能の使用が許可されていません', 'error');
                        } else {
                            console.error('❌ シェアエラー:', error);
                            showNotification('エラー', 'シェアに失敗しました', 'error');
                        }
                    })
                    .finally(() => {
                        isSharing = false;
                    });
            } else {
                // Web Share API非対応の場合はクリップボードにコピー
                copyProgressToClipboard();
            }
        }
        
        // Web Share API非対応時のクリップボードコピー機能
        function copyProgressToClipboard() {
            const studyData = getStoredData();
            const averageProgress = calculateAverageProgress(studyData);
            const totalHours = calculateTotalHours(studyData);
            
            const shareText = `中小企業診断士合格ロードマップ\n学習進捗: ${averageProgress}% (総学習時間: ${totalHours}時間)\n効率的な学習で合格を目指しています！\n${window.location.href}`;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareText)
                    .then(() => {
                        showNotification('成功', '進捗情報をクリップボードにコピーしました！', 'success');
                    })
                    .catch((error) => {
                        console.error('❌ クリップボードコピーエラー:', error);
                        fallbackCopyToClipboard(shareText);
                    });
            } else {
                fallbackCopyToClipboard(shareText);
            }
        }
        
        // クリップボードAPIが使えない場合のフォールバック
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const result = document.execCommand('copy');
                if (result) {
                    showNotification('成功', '進捗情報をコピーしました！', 'success');
                } else {
                    showNotification('情報', 'テキストを手動でコピーしてください', 'info');
                }
            } catch (error) {
                console.error('❌ フォールバックコピーエラー:', error);
                showNotification('情報', 'シェア機能は現在利用できません', 'info');
            } finally {
                document.body.removeChild(textArea);
            }
        }
        
        // 通知表示
        function showNotification(title, message, type = 'info') {
            console.log(`🔔 通知: ${type} - ${title}: ${message}`);
            
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            const icons = {
                success: '<i class="fas fa-check-circle text-green-600"></i>',
                error: '<i class="fas fa-exclamation-circle text-red-600"></i>',
                info: '<i class="fas fa-info-circle text-blue-600"></i>'
            };
            
            icon.innerHTML = icons[type] || icons.info;
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 5000);
        }
        
        // 多言語対応（簡易版）
        function updateTexts() {
            const texts = {
                ja: {
                    welcome_title: '学習ダッシュボード',
                    welcome_message: '今日も合格に向けて頑張りましょう！'
                },
                en: {
                    welcome_title: 'Learning Dashboard',
                    welcome_message: 'Let\'s work hard towards passing the exam today!'
                }
            };
            
            const currentTexts = texts[currentLang] || texts.ja;
            
            Object.keys(currentTexts).forEach(key => {
                const elements = document.querySelectorAll(`[data-i18n="${key}"]`);
                elements.forEach(element => {
                    element.textContent = currentTexts[key];
                });
            });
        }
        
        // Service Worker登録（PWA対応）
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('✅ Service Worker登録成功:', registration.scope);
                    })
                    .catch(error => {
                        console.log('❌ Service Worker登録失敗:', error);
                    });
            });
        }
        
        // パフォーマンス向上のためのパッシブイベントリスナー設定
        (function() {
            // パッシブイベントリスナーのサポートをチェック
            let supportsPassive = false;
            try {
                const opts = Object.defineProperty({}, 'passive', {
                    get: function() {
                        supportsPassive = true;
                    }
                });
                window.addEventListener('testPassive', null, opts);
                window.removeEventListener('testPassive', null, opts);
            } catch (e) {}
            
            // Touch eventにパッシブオプションを追加
            if (supportsPassive) {
                document.addEventListener('touchstart', function() {}, { passive: true });
                document.addEventListener('touchmove', function() {}, { passive: true });
                document.addEventListener('wheel', function() {}, { passive: true });
            }
        })();
        
        console.log('🎉 中小企業診断士合格ロードマップ - スクリプト読み込み完了');
    </script>
    <script src="js/header.js"></script>
</body>
</html>