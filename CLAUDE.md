# プロジェクト概要
このプロジェクトは、中小企業診断士合格ロードマップの学習管理システムを提供することを目的としています。
主要技術スタック: HTML5, CSS3, JavaScript (Vanilla), Tailwind CSS, Chart.js, localStorage, Service Worker (PWA)
開発チームは、クリーンで保守性の高いコードを重視しています。

# 開発ワークフロー
すべての機能実装および修正は、以下のワークフローに従って実行すること。

## 1. ソースコードの最新化
*   作業開始前に必ず `git pull` を実行し、コードベースを最新の状態にすること。

## 2. 変更の実装と自己検証
*   「**最適で完全な形**」でコードを修正し、関連する全てのファイルに一貫性を持たせること。
*   **変更による横展開（サイドエフェクト）が必要ないか**、コードベース全体を綿密にチェックすること。
*   ローカル環境で以下のテストを**自動的に実施**し、**自己検証**を徹底すること。
    *   機能テスト: 新機能が意図通りに動作することを確認。
    *   退行テスト: 既存機能が変更によって壊れていないことを確認。
    *   必要に応じて、**スクリーンショットを撮影**したり、**headlessブラウザ**（MCPサーバー経由で利用）を用いてUIの視覚的検証も行うこと。コンソールエラーが出ない状態にすること。
*   プロジェクトのリポジトリ管理が不要なファイル（例: 環境設定ファイル、ビルド成果物など）は、**`.gitignore`に適切に追加**し、コミットされないようにすること。

## 3. ドキュメントの更新
*   新機能を実装した場合、必ず**`function.html`を更新**し、機能の概要と使用方法を明記すること。
*   変更内容が**`README.md`または`SPEC.md`に記載すべき場合**は、これらのドキュメントも併せて更新し、常に最新の状態を保つこと。

## 4. コミットとプッシュ（自動承認）
*   **私に確認することなく**、すべての変更が上記ガイドラインを満たしていることを確認した後、**自動的に`git add`, `git commit`, `git push`を実行すること**。
    *   コミットメッセージは、変更内容を明確に要約し、必要に応じて変更の背景も簡潔に記述すること。
    *   Git Hooks（例: Lefthook）で設定されたプリコミットフックが実行されるようにすること（`.claude/settings.json`でGit操作が許可されていれば自動的に実行される）。

## 5. デプロイ後のテスト（自動検証）
*   `git push`完了後、**デプロイされたWebアプリケーションに対する動作テストと退行テスト**を自動で実行し、本番環境でコンソールエラーが出ない状態であることを確認すること。
    *   このフェーズはGitHub Pagesの自動デプロイと連携して実行されることを想定。

# コーディング規約
*   すべてのコードは、プロジェクトの既存スタイルガイドに準拠すること。
*   エラーハンドリングは、常に堅牢で明確に行うこと。
*   変数の命名規則、関数の構成などは、プロジェクトの慣習に従うこと。
*   日本語UIのため、文字エンコーディングは必ずUTF-8を使用すること。

# ツール定義
Claude Codeは、以下のツールとコマンドを利用できる。
*   `python3 -m http.server 8000`: ローカルHTTPサーバーの起動（開発用）。
*   `git`: バージョン管理操作（add, commit, push, pullなど）。
*   `curl`: 外部APIとの連携やデータ取得、デプロイされたサイトの動作確認。
*   `pkill`: プロセス管理。
*   `python3`, `pip3`: Pythonスクリプトの実行やパッケージ管理。
*   `grep`, `sed`, `find`, `ls`: ファイルシステム操作および検索。
*   `convert`: 画像処理（例: スクリーンショットの形式変換など）。
*   `cp`, `edit`: ファイル操作。
*   GitHub Pages: 本番環境へのデプロイ（main ブランチへのプッシュで自動デプロイ）。

# 重要な注意事項
*   不明な点や、想定外の挙動が発生した場合は、**`Esc`キーで即座に処理を中断**し、必要に応じて**`Esc`キーを2回押して直前のプロンプトを編集**すること。
*   新しいタスクを開始する際や、コンテキストが複雑になった場合は、**/clearコマンド**を使用してコンテキストをリセットし、精度の高い出力を確保すること。
*   **「think hard」や「ultrathink」などの拡張思考モード**を積極的に活用し、複雑な問題に対してより深い分析と解決策を提供すること。
*   日本語の文字化け（mojibake）が発生した場合は、必ずUTF-8エンコーディングで修正すること。

# 最近の修正履歴

## 2025年7月25日 - 文字化け（mojibake）修正

### 修正内容
過去問演習システムの日本語文字化け問題を完全修正。

**問題**: 
- quiz.jsファイルで日本語文字が�などの文字化け文字に破損
- 過去問の問題文、選択肢、解説が読み取り不可状態
- 文字エンコーディング破損による機能不全

**対応**: 
- quiz.jsファイルを正しいUTF-8エンコーディングで完全再作成（592行）
- 全日本語コメント、文字列を適切なエンコーディングで修復
- 他JavaScriptファイルのエンコーディング問題チェック実施
- HTMLファイルのcharset="UTF-8"宣言確認

**変更箇所**：
```javascript
// Before: 文字化け状態
question: '������������������������������',

// After: 正常な日本語
question: '完全競争市場における企業の短期均衡について、正しい記述はどれか。',
```

**結果**: 
- 過去問演習システムの完全復旧
- 日本語テキストの完全可読性回復
- 7科目21問の全問題データ正常表示
- エンコーディング問題の根本解決

### 検証項目
- ✅ ローカルサーバーでの動作確認
- ✅ 全科目の問題文・選択肢・解説表示確認
- ✅ 他JSファイルのエンコーディング問題チェック
- ✅ HTMLファイルのcharset宣言確認

## 2025年7月25日 - トップページ過去問演習ナビゲーション修正

### 修正内容  
トップページの「過去問演習」ボタンクリック時に進めない問題を修正。

**問題**: 
- クイックアクションの過去問演習ボタンをクリックしても「開発中です」メッセージのみ表示
- `startQuiz()`関数が開発中の旧実装のまま残っていた

**対応**: 
- `onclick="startQuiz()"`から`<a href="quiz.html">`への直接リンクに変更
- 不要な`startQuiz()`関数を削除して清潔なコードに整理
- セマンティックHTMLでアクセシビリティを向上

**変更箇所**：
```html
<!-- Before -->
<div onclick="startQuiz()">過去問演習</div>

<!-- After -->  
<a href="quiz.html">過去問演習</a>
```

**結果**: 
- トップページから過去問演習ページへの正常な遷移
- 直接的なナビゲーションによるUX向上
- 不要なJavaScript関数の削除でコード簡潔化

### 検証項目
- ✅ ローカルサーバーでの動作確認
- ✅ クイックアクションボタンの動作確認
- ✅ quiz.htmlページの正常アクセス確認
- ✅ 既存機能への影響がないことを確認

## 2025年7月25日 - 今日の日付表示修正

### 修正内容
ダッシュボードで「今日の日付」が表示されない問題を修正。

**問題**: 
- モジュラーリファクタリング後、DashboardComponentが初期化されていない
- 日付更新関数`updateCurrentDate()`が呼び出されていない

**対応**: 
- メインコンテンツ要素に`id="dashboard"`を追加してDashboardComponent初期化を有効化
- レガシー関数`updateCurrentDate()`を直接呼び出してフォールバック対応
- 100msタイムアウトで再実行して確実に日付表示

**結果**: 
- 「今日の日付」が正常に日本語形式で表示
- モジュラーアーキテクチャとレガシーコードの共存実現

### 検証項目
- ✅ ローカルサーバーでの動作確認
- ✅ 日付表示機能の動作確認
- ✅ 他ページへの影響がないことを確認
- ✅ レスポンシブ表示の確認

## 2025年7月25日 - ヘッダー固定化・ハンバーガーメニュー修正

### 修正内容
ヘッダーの固定化とモバイルハンバーガーメニューの動作不具合を修正。

**問題**: 
- ヘッダーがスクロール時に隠れてしまう
- モバイルハンバーガーメニューボタンが押せない（z-index問題）

**対応**: 
- デスクトップ・モバイル両ヘッダーに`fixed top-0`を適用し固定化
- メインコンテンツに`pt-16`（デスクトップ）、`pt-24`（モバイル）で上部余白追加
- ハンバーガーメニューボタンに`z-50`とフォーカススタイル追加
- モバイルサイドバーとオーバーレイの位置調整（`top-16`から開始）

**対象ファイル**: index.html、quiz.html

**結果**: 
- ヘッダー常時表示で操作性向上
- ハンバーガーメニュー正常動作
- レスポンシブデザイン完全対応

### 検証項目
- ✅ ローカルサーバーでの動作確認
- ✅ デスクトップ・モバイル両対応
- ✅ ハンバーガーメニュー動作確認
- ✅ コンテンツ表示位置調整確認

## 2025年7月25日 - Service Worker登録エラー修正

### 修正内容
Service Worker登録時の404エラー「A bad HTTP response code (404) was received when fetching the script」を修正。

**問題**: app.jsでService Workerを絶対パス`/sw.js`で登録していたが、GitHub Pagesのサブディレクトリでは404エラーが発生
**対応**: 相対パス`./sw.js`に変更してGitHub Pages環境に適合
**結果**: Service Worker正常登録、PWA機能完全復旧

### 検証項目
- ✅ ローカルサーバーでの動作確認
- ✅ Service Workerファイルアクセシビリティ確認
- ✅ 他ページの互換性チェック
- ✅ 回帰テスト実行

## 2025年7月25日 - JavaScriptエンコーディングエラー修正

### 修正内容
app.js:101の構文エラー「Unexpected identifier 'UD'」を修正。

**問題**: 文字エンコーディング問題により日本語文字列が破損、JavaScriptコンソールエラー発生
**対応**: app.jsファイルを正しいUTF-8エンコーディングで再作成
**結果**: コンソールエラー完全解消、アプリケーション正常動作

### 検証項目
- ✅ ローカルサーバーでの動作確認
- ✅ 他JSファイルのエンコーディング問題チェック  
- ✅ ダッシュボード機能の動作確認
- ✅ 回帰テスト実行

## 2024年1月 - 過去問演習機能の実装
*   **実装内容**: 中小企業診断士試験7科目対応の本格的な過去問演習システム
*   **主要機能**: 
    *   7科目対応の過去問データベース（各科目3問以上、計21問収録）
    *   科目選択機能（全科目・個別科目選択可能）
    *   問題数設定（10問・20問・50問・全問から選択）
    *   出題モード（ランダム・順番・間違えた問題のみ）
    *   制限時間設定（30分・60分・90分・120分）
    *   問題ナビゲーション（前の問題・次の問題・問題一覧モーダル）
    *   マーク機能（後で見直す問題の管理）
    *   リアルタイム進捗表示・タイマー機能（警告表示付き）
    *   詳細結果分析（正答率・科目別統計・間違えた問題の解説表示）
    *   演習履歴管理（過去50件の記録保存・表示）
    *   レスポンシブ対応（PC・タブレット・スマホ）
    *   オフライン対応（Service Worker更新）
*   **技術詳細**: Quiz システムクラス、localStorage活用、Chart.js統合、PWA対応
*   **ファイル構成**: quiz.html、js/quiz-data.js、js/quiz.js
*   **横展開**: 全ページナビゲーションに過去問演習リンク追加、ドキュメント更新

## 2024年1月 - ランディングページ（LP）の実装
*   **実装内容**: サービス紹介と価値提案のためのランディングページ
*   **主要機能**: 
    *   ヒーローセクションとグラディエント背景
    *   6つの主要機能の詳細説明（カード型デザイン）
    *   統計情報セクション（合格率5%、7科目、1000時間）
    *   他サービスとの比較表
    *   利用者の声・体験談セクション
    *   FAQ（よくある質問）セクション
    *   CTA（コール・トゥ・アクション）
    *   スムーススクロール機能とトップへ戻るボタン
    *   レスポンシブデザイン対応
*   **技術詳細**: Tailwind CSS、Font Awesome、アニメーション効果、スムーススクロール

## 2024年1月 - 詳細進捗分析機能の実装
*   **実装内容**: 科目別の詳細統計と多角的な進捗分析機能
*   **主要機能**: 
    *   詳細進捗モーダルウィンドウ（フルスクリーン対応）
    *   科目別詳細統計（学習時間、目標達成率、残り時間）
    *   週次学習時間推移グラフ（直近8週間）
    *   学習履歴タイムライン（最新20件）
    *   複合グラフ（進捗率＋学習時間の同時表示）
    *   タブ切り替えによる3つの分析視点
    *   必要学習時間/日の自動計算
*   **技術詳細**: Chart.js複合グラフ、動的DOM生成、レスポンシブ対応

## 2024年1月 - Service Workerキャッシュエラー修正
*   **問題**: Service Worker登録時にaddAll()でキャッシュエラーが発生
*   **解決策**: 
    *   相対パス（./）を使用してGitHub Pages環境に対応
    *   ローカルリソースと外部リソースを分離してキャッシュ
    *   エラーハンドリングを強化し、個別リソースのエラーでも継続
    *   CORSエラーを考慮した外部リソースの取得方法を実装
*   **結果**: Service Workerが正常に登録され、PWA機能が有効化

## 2024年1月 - Web Share APIコンソールエラー修正
*   **問題**: Web Share API使用時にInvalidStateErrorとAbortErrorが発生
*   **解決策**: 
    *   重複実行防止フラグ(isSharing)を実装
    *   Promise.catch()による適切なエラーハンドリング
    *   AbortError（ユーザーキャンセル）を正常動作として処理
    *   Web Share API非対応ブラウザ向けのクリップボードフォールバック機能を強化
*   **結果**: コンソールエラーが解消され、全ブラウザで安定したシェア機能を提供

# プロジェクト固有の情報
*   **本番URL**: https://appadaycreator.github.io/shindanshi-roadmap/
*   **GitHubリポジトリ**: https://github.com/appadaycreator/shindanshi-roadmap
*   **主要ページ**:
    *   index.html: メインダッシュボード
    *   lp.html: ランディングページ（サービス紹介）
    *   usage.html: 使い方ガイド
    *   function.html: 機能仕様書
*   **データ保存**: localStorageを使用（サーバーレス）
*   **対象ユーザー**: 中小企業診断士試験受験者